#!/usr/bin/env ruby

require 'xcbuild'
require 'xcpretty'
require 'optparse'

# read .xcbuild file

#  xcodebuild
#   determine project
#   determine workspace
#   determine target/scheme
#   determine sdk
#   passthrough
#  xcpretty
#   passthrough

# xcodebuild | xcpretty

build_opts = ARGV.join(' ')
pretty_opts = '-c'

puts build_opts

system [
  "xcodebuild #{build_opts} ",
  "| xcpretty #{pretty_opts} ",
  '&& exit ${PIPESTATUS[0]}'
].join

# it works!!!
